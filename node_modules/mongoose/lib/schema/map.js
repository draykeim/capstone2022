'use strict';

/*!
 * ignore
 */

const MongooseMap = require('../types/map');
<<<<<<< HEAD
const SchemaType = require('../schematype');

=======
const SchemaMapOptions = require('../options/SchemaMapOptions');
const SchemaType = require('../schematype');
>>>>>>> f48a1595ee4da78cea13c4049a9ef48e9e70b5fa
/*!
 * ignore
 */

class Map extends SchemaType {
  constructor(key, options) {
    super(key, options, 'Map');
    this.$isSchemaMap = true;
  }

<<<<<<< HEAD
=======
  set(option, value) {
    return SchemaType.set(option, value);
  }

>>>>>>> f48a1595ee4da78cea13c4049a9ef48e9e70b5fa
  cast(val, doc, init) {
    if (val instanceof MongooseMap) {
      return val;
    }

    if (init) {
      const map = new MongooseMap({}, this.path, doc, this.$__schemaType);

      if (val instanceof global.Map) {
        for (const key of val.keys()) {
<<<<<<< HEAD
          map.$init(key, map.$__schemaType.cast(val.get(key), doc, true));
        }
      } else {
        for (const key of Object.keys(val)) {
          map.$init(key, map.$__schemaType.cast(val[key], doc, true));
=======
          let _val = val.get(key);
          if (_val == null) {
            _val = map.$__schemaType._castNullish(_val);
          } else {
            _val = map.$__schemaType.cast(_val, doc, true);
          }
          map.$init(key, _val);
        }
      } else {
        for (const key of Object.keys(val)) {
          let _val = val[key];
          if (_val == null) {
            _val = map.$__schemaType._castNullish(_val);
          } else {
            _val = map.$__schemaType.cast(_val, doc, true);
          }
          map.$init(key, _val);
>>>>>>> f48a1595ee4da78cea13c4049a9ef48e9e70b5fa
        }
      }

      return map;
    }

    return new MongooseMap(val, this.path, doc, this.$__schemaType);
  }
<<<<<<< HEAD
}

=======

  clone() {
    const schematype = super.clone();

    if (this.$__schemaType != null) {
      schematype.$__schemaType = this.$__schemaType.clone();
    }
    return schematype;
  }
}

Map.prototype.OptionsConstructor = SchemaMapOptions;

Map.defaultOptions = {};

>>>>>>> f48a1595ee4da78cea13c4049a9ef48e9e70b5fa
module.exports = Map;
